<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pesan Layanan - RSU YK Madira</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(117deg, #FFF 0%, #E3B2D3 49.53%, #55ACBF 99.06%);
    }
    .hero-bg {
      background: url('img/hospital-bg.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    .form-bg {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
    }
  </style>
</head>
<body class="min-h-screen">

  <!-- Header Navigation -->
  <header class="bg-white/90 backdrop-blur-md shadow-lg sticky top-0 z-50">
    <!-- Main Navbar -->
    <nav class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <!-- Logo -->
        <div class="flex items-center space-x-3">
          <img src="img/logo-rsu.png" alt="RSU YK Madira" class="w-16 h-16">
        </div>

        <!-- Navigation Menu & Login Button -->
        <div class="flex items-center space-x-8">
          <!-- Navigation Menu -->
          <div class="hidden md:flex space-x-8">
            <a href="dashboard-user.html#beranda" class="text-[#4C7990] hover:text-[#55ACBF] font-medium transition-colors">Beranda</a>
            <a href="dashboard-user.html#tentang" class="text-[#4C7990] hover:text-[#55ACBF] font-medium transition-colors">Tentang Kami</a>
            <a href="dashboard-user.html#dokter" class="text-[#4C7990] hover:text-[#55ACBF] font-medium transition-colors">Dokter dan Jadwal Praktek</a>
            <a href="dashboard-user.html#fasilitas" class="text-[#4C7990] hover:text-[#55ACBF] font-medium transition-colors">Fasilitas dan Tarif</a>
          </div>

          <!-- Login Button -->
          <button onclick="window.location.href='login.html'" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-full font-medium transition-colors">
            Login
          </button>
        </div>

        <!-- Mobile Menu Button -->
        <button class="md:hidden text-[#4C7990]">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </nav>

    <!-- Contact Information Bar -->
    <div class="bg-[#E3B2D3] py-2">
      <div class="container mx-auto px-6">
        <div class="flex justify-center items-center space-x-8 text-sm text-white">
          <span class="flex items-center">
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
              <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
            </svg>
            admin@rsuykmaira.com
          </span>
          <span class="flex items-center">
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
            </svg>
            08571100888
          </span>
          <span class="flex items-center">
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
            </svg>
            06:00 - 22:00 (Senin-Sabtu)
          </span>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Section with Form -->
  <section class="hero-bg min-h-screen flex items-center justify-center py-8">
    <div class="container mx-auto px-6">
      <div class="form-bg rounded-3xl p-8 max-w-4xl mx-auto shadow-2xl">
        <!-- Header -->
        <div class="text-center mb-8">
          <h1 class="text-4xl md:text-5xl font-bold text-[#4C7990] mb-4">Pesan Layanan</h1>
          <p class="text-gray-600">Silakan isi formulir berikut untuk membuat janji temu dengan dokter</p>
        </div>

        <!-- Form -->
        <form id="bookingForm" class="space-y-6">
          <!-- Identitas Pasien -->
          <div class="bg-white/70 rounded-2xl p-6">
            <h2 class="text-2xl font-bold text-[#8B1538] mb-6">Identitas Pasien</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Nama Lengkap -->
              <div>
                <label class="block text-[#8B1538] font-semibold mb-2">Nama Lengkap</label>
                <input type="text" id="namaLengkap" name="nama_lengkap" required
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors"
                       placeholder="Masukkan nama lengkap">
              </div>

              <!-- NIK/Nomor Rekam Medis -->
              <div>
                <label class="block text-[#8B1538] font-semibold mb-2">NIK/Nomor Rekam Medis</label>
                <input type="text" id="nik" name="nik" required
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors"
                       placeholder="Masukkan NIK atau No. RM">
              </div>

              <!-- Tanggal Lahir -->
              <div>
                <label class="block text-[#8B1538] font-semibold mb-2">Tanggal Lahir</label>
                <input type="date" id="tanggalLahir" name="tanggal_lahir" required
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors">
              </div>

              <!-- Email (Optional) -->
              <div>
                <label class="block text-[#8B1538] font-semibold mb-2">Email (Opsional)</label>
                <input type="email" id="email" name="email"
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors"
                       placeholder="email@contoh.com">
              </div>

              <!-- Alamat -->
              <div class="md:col-span-2">
                <label class="block text-[#8B1538] font-semibold mb-2">Alamat</label>
                <textarea id="alamat" name="alamat" rows="3" required
                          class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors resize-none"
                          placeholder="Masukkan alamat lengkap"></textarea>
              </div>

              <!-- Nomor Telepon/WA -->
              <div class="md:col-span-2">
                <label class="block text-[#8B1538] font-semibold mb-2">Nomor Telepon/WA</label>
                <input type="tel" id="telepon" name="telepon" required
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors"
                       placeholder="08xxxxxxxxxx">
              </div>
            </div>
          </div>

          <!-- Layanan dan Jadwal -->
          <div class="bg-white/70 rounded-2xl p-6">
            <h2 class="text-2xl font-bold text-[#8B1538] mb-6">Layanan dan Jadwal</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Jenis Layanan -->
              <div>
                <label class="block text-[#8B1538] font-semibold mb-2">Jenis Layanan</label>
                <select id="jenisLayanan" name="jenis_layanan" required
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors">
                  <option value="">Pilih Jenis Layanan</option>
                  <option value="konsultasi">Konsultasi Dokter</option>
                  <option value="pemeriksaan">Pemeriksaan Umum</option>
                  <option value="lab">Pemeriksaan Laboratorium</option>
                  <option value="radiologi">Pemeriksaan Radiologi</option>
                  <option value="fisioterapi">Fisioterapi</option>
                  <option value="gigi">Perawatan Gigi</option>
                </select>
              </div>

              <!-- Poliklinik/Unit Penunjang -->
              <div>
                <label class="block text-[#8B1538] font-semibold mb-2">Poliklinik/Unit Penunjang</label>
                <select id="poliklinik" name="poliklinik" required
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors">
                  <option value="">Pilih Poliklinik</option>
                  <option value="umum">Poli Umum</option>
                  <option value="anak">Poli Anak</option>
                  <option value="jantung">Poli Jantung</option>
                  <option value="kandungan">Poli Kandungan</option>
                  <option value="bedah">Poli Bedah</option>
                  <option value="mata">Poli Mata</option>
                  <option value="kulit">Poli Kulit & Kelamin</option>
                  <option value="tht">Poli THT</option>
                  <option value="saraf">Poli Saraf</option>
                  <option value="paru">Poli Paru</option>
                </select>
              </div>

              <!-- Tanggal Kunjungan -->
              <div>
                <label class="block text-[#8B1538] font-semibold mb-2">Tanggal Kunjungan</label>
                <input type="date" id="tanggalKunjungan" name="tanggal_kunjungan" required
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors">
              </div>

              <!-- Dokter -->
              <div>
                <label class="block text-[#8B1538] font-semibold mb-2">Dokter</label>
                <select id="dokter" name="dokter" required
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors">
                  <option value="">Pilih Dokter</option>
                  <!-- Options akan diisi melalui JavaScript berdasarkan poliklinik -->
                </select>
              </div>

              <!-- Metode Pembayaran -->
              <div>
                <label class="block text-[#8B1538] font-semibold mb-2">Metode Pembayaran</label>
                <select id="metodePembayaran" name="metode_pembayaran" required
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors">
                  <option value="">Pilih Metode Pembayaran</option>
                  <option value="tunai">Tunai</option>
                  <option value="bpjs">BPJS Kesehatan</option>
                  <option value="asuransi">Asuransi Swasta</option>
                  <option value="transfer">Transfer Bank</option>
                  <option value="kartu_kredit">Kartu Kredit</option>
                </select>
              </div>

              <!-- Unggah Dokumen Pendukung -->
              <div>
                <label class="block text-[#8B1538] font-semibold mb-2">Unggah Dokumen Pendukung</label>
                <input type="file" id="dokumenPendukung" name="dokumen_pendukung" 
                       accept=".pdf,.jpg,.jpeg,.png"
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#55ACBF] file:text-white hover:file:bg-[#4C7990]">
                <p class="text-xs text-gray-500 mt-1">Format: PDF, JPG, PNG (Maks. 5MB)</p>
              </div>

              <!-- Catatan Tambahan -->
              <div class="md:col-span-2">
                <label class="block text-[#8B1538] font-semibold mb-2">Catatan Tambahan</label>
                <textarea id="catatanTambahan" name="catatan_tambahan" rows="3"
                          class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#55ACBF] focus:outline-none transition-colors resize-none"
                          placeholder="Jelaskan keluhan atau informasi tambahan yang diperlukan"></textarea>
              </div>
            </div>
          </div>

          <!-- Submit Buttons -->
          <div class="flex flex-col sm:flex-row gap-4 justify-center pt-6">
            <button type="button" onclick="saveDraft()" 
                    class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-full font-medium text-lg transition-colors">
              📄 Draft
            </button>
            <button type="submit" 
                    class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full font-medium text-lg transition-colors">
              ✅ Booking
            </button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gradient-to-r from-red-800 to-red-900 text-white py-12">
    <div class="container mx-auto px-6">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold mb-4" style="font-family: 'Brush Script MT', cursive;">
          Melayani Sepenuh Hati, Menjadi Andalan Anda
        </h2>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
        <!-- Alamat -->
        <div>
          <h3 class="font-bold mb-2">📍 Alamat</h3>
          <p class="text-sm">
            Jl. Jend. Sudirman No.1681, 20 Ilir D. I, Kec. Ilir Tim. I, Kota Palembang,<br>
            Sumatera Selatan 30114
          </p>
        </div>
        
        <!-- Informasi -->
        <div>
          <h3 class="font-bold mb-2">ℹ️ Informasi</h3>
          <div class="flex justify-center space-x-4">
            <a href="#" class="hover:text-pink-300">📘</a>
            <a href="#" class="hover:text-pink-300">📧</a>
            <a href="#" class="hover:text-pink-300">📞</a>
          </div>
        </div>
        
        <!-- Jadwal Buka -->
        <div>
          <h3 class="font-bold mb-2">🕐 Jadwal Buka</h3>
          <p class="text-sm">06:00 - 22:00 (Setiap Sore)</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Copyright -->
  <div class="bg-black text-white text-center py-4">
    <p class="text-sm">Copyright © 2025 RSU YK Madira | All rights reserved.</p>
  </div>

  <!-- JavaScript -->
  <script>
    // Data dokter berdasarkan poliklinik
    const dokterByPoliklinik = {
      'umum': [
        { id: 'dr_umum_1', nama: 'Dr. Ahmad Fauzi', jadwal: 'Senin-Jumat 08:00-12:00' },
        { id: 'dr_umum_2', nama: 'Dr. Siti Aminah', jadwal: 'Selasa-Sabtu 13:00-17:00' }
      ],
      'anak': [
        { id: 'dr_anak_1', nama: 'Dr. Desti Handayani, Sp.A', jadwal: 'Senin, Selasa-Sabtu 18:30-20:00' }
      ],
      'jantung': [
        { id: 'dr_jantung_1', nama: 'Dr. Ahmad Subanto, Sp.JP', jadwal: 'Senin-Jumat 08:00-12:00' }
      ],
      'kandungan': [
        { id: 'dr_kandungan_1', nama: 'Dr. Sari Indrawati, Sp.OG', jadwal: 'Selasa, Kamis, Sabtu 14:00-17:00' }
      ],
      'bedah': [
        { id: 'dr_bedah_1', nama: 'Dr. Budi Santoso, Sp.B', jadwal: 'Senin, Rabu, Jumat 07:00-11:00' }
      ],
      'mata': [
        { id: 'dr_mata_1', nama: 'Dr. Lisa Permata, Sp.M', jadwal: 'Senin-Sabtu 13:00-16:00' }
      ],
      'kulit': [
        { id: 'dr_kulit_1', nama: 'Dr. Rizky Pratama, Sp.KK', jadwal: 'Selasa-Kamis 09:00-12:00' }
      ],
      'tht': [
        { id: 'dr_tht_1', nama: 'Dr. Maya Sari, Sp.THT', jadwal: 'Senin, Rabu, Jumat 15:00-18:00' }
      ],
      'saraf': [
        { id: 'dr_saraf_1', nama: 'Dr. Andi Wijaya, Sp.S', jadwal: 'Selasa, Kamis, Sabtu 08:00-11:00' }
      ],
      'paru': [
        { id: 'dr_paru_1', nama: 'Dr. Nina Kartika, Sp.P', jadwal: 'Senin-Jumat 16:00-19:00' }
      ]
    };

    // Update dokter berdasarkan poliklinik yang dipilih
    document.getElementById('poliklinik').addEventListener('change', function() {
      const poliklinik = this.value;
      const dokterSelect = document.getElementById('dokter');
      
      // Reset options
      dokterSelect.innerHTML = '<option value="">Pilih Dokter</option>';
      
      if (poliklinik && dokterByPoliklinik[poliklinik]) {
        dokterByPoliklinik[poliklinik].forEach(dokter => {
          const option = document.createElement('option');
          option.value = dokter.id;
          option.textContent = `${dokter.nama} - ${dokter.jadwal}`;
          dokterSelect.appendChild(option);
        });
      }
    });

    // Set minimum date untuk tanggal kunjungan (hari ini + 1)
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    const minDate = tomorrow.toISOString().split('T')[0];
    document.querySelector('[name="tanggal_kunjungan"]').setAttribute('min', minDate);

    // Form submission
    document.getElementById('bookingForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Validasi form
      if (!validateForm()) {
        return;
      }
      
      // Show loading message
      showLoadingMessage();
      
      // Submit to API
      submitBooking();
    });

    // Submit booking to API
    async function submitBooking() {
      try {
        const formData = new FormData(document.getElementById('bookingForm'));
        
        const response = await fetch('api/bookings.php', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (result.success) {
          // Show success message
          showSuccessMessage(result.data.booking_id);
        } else {
          throw new Error(result.message || 'Gagal membuat booking');
        }
      } catch (error) {
        console.error('Error submitting booking:', error);
        
        // Reset button
        const submitBtn = document.querySelector('button[type="submit"]');
        submitBtn.disabled = false;
        submitBtn.innerHTML = '✅ Booking';
        
        // Show error message
        alert('❌ Gagal membuat booking: ' + error.message + '\n\nSilakan coba lagi atau hubungi customer service di 08571100888');
      }
    }

    // Validasi form
    function validateForm() {
      const requiredFields = ['nama_lengkap', 'nik', 'tanggal_lahir', 'alamat', 'telepon', 
                            'jenis_layanan', 'poliklinik', 'tanggal_kunjungan', 'dokter', 'metode_pembayaran'];
      
      for (let field of requiredFields) {
        const element = document.querySelector(`[name="${field}"]`);
        if (!element.value.trim()) {
          element.focus();
          alert(`Field ${element.previousElementSibling.textContent} harus diisi!`);
          return false;
        }
      }
      
      // Validasi format telepon
      const telepon = document.querySelector('[name="telepon"]').value;
      if (!/^08\d{8,11}$/.test(telepon)) {
        alert('Format nomor telepon tidak valid! Gunakan format 08xxxxxxxxxx');
        document.querySelector('[name="telepon"]').focus();
        return false;
      }
      
      return true;
    }

    // Simpan draft
    function saveDraft() {
      const formData = new FormData(document.getElementById('bookingForm'));
      const draftData = {};
      for (let [key, value] of formData.entries()) {
        draftData[key] = value;
      }
      
      localStorage.setItem('bookingDraft', JSON.stringify(draftData));
      alert('Draft berhasil disimpan!');
    }

    // Load draft jika ada
    function loadDraft() {
      const draft = localStorage.getItem('bookingDraft');
      if (draft) {
        const draftData = JSON.parse(draft);
        for (let [key, value] of Object.entries(draftData)) {
          const element = document.getElementById(key);
          if (element) {
            element.value = value;
            // Trigger change event untuk update dokter
            if (key === 'poliklinik') {
              element.dispatchEvent(new Event('change'));
            }
          }
        }
      }
    }

    // Show loading message
    function showLoadingMessage() {
      const submitBtn = document.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '⏳ Memproses booking...';
    }

    // Show success message
    function showSuccessMessage(bookingId) {
      alert(`🎉 Booking berhasil!\n\nID Booking: ${bookingId}\n\nSilakan catat ID booking Anda untuk keperluan konfirmasi.\n\nAnda akan dihubungi melalui WhatsApp untuk konfirmasi lebih lanjut.`);
      
      // Reset form
      document.getElementById('bookingForm').reset();
      document.getElementById('dokter').innerHTML = '<option value="">Pilih Dokter</option>';
      
      // Reset button
      const submitBtn = document.querySelector('button[type="submit"]');
      submitBtn.disabled = false;
      submitBtn.innerHTML = '✅ Booking';
      
      // Redirect ke dashboard setelah beberapa detik
      setTimeout(() => {
        window.location.href = 'dashboard-user.html';
      }, 3000);
    }

    // Load draft saat halaman dimuat
    document.addEventListener('DOMContentLoaded', function() {
      loadDraft();
    });

    // Smooth scroll untuk navigation
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  </script>

</body>
</html>
